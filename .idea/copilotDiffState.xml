<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/prog7314/geoquest/screens/LogbookScreen_NEW.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/prog7314/geoquest/screens/LogbookScreen_NEW.kt" />
              <option name="updatedContent" value="package com.prog7314.geoquest.screens&#10;&#10;import androidx.compose.animation.AnimatedVisibility&#10;import androidx.compose.animation.core.tween&#10;import androidx.compose.animation.fadeOut&#10;import androidx.compose.animation.shrinkVertically&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Add&#10;import androidx.compose.material.icons.filled.Delete&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import androidx.navigation.NavController&#10;import androidx.navigation.compose.rememberNavController&#10;import com.prog7314.geoquest.components.cards.LocationCard&#10;import com.prog7314.geoquest.components.overlays.CenteredLoadingIndicator&#10;import com.prog7314.geoquest.data.data.LocationData&#10;import com.prog7314.geoquest.data.model.LocationViewModel&#10;import com.prog7314.geoquest.data.model.UserViewModel&#10;import com.prog7314.geoquest.ui.theme.PROG7314Theme&#10;import java.net.URLEncoder&#10;import java.nio.charset.StandardCharsets&#10;import java.util.*&#10;import com.prog7314.geoquest.components.common.StyledFilterChip&#10;&#10;enum class VisibilityFilter {&#10;    ALL, PUBLIC, PRIVATE&#10;}&#10;&#10;@Composable&#10;fun LogbookScreen(&#10;    navController: NavController,&#10;    userViewModel: UserViewModel,&#10;    locationViewModel: LocationViewModel = run {&#10;        val context = LocalContext.current&#10;        viewModel(&#10;            factory = androidx.lifecycle.ViewModelProvider.AndroidViewModelFactory.getInstance(&#10;                context.applicationContext as android.app.Application&#10;            )&#10;        )&#10;    }&#10;) {&#10;    val currentUser by userViewModel.currentUser.collectAsState()&#10;    val locations by locationViewModel.locations.collectAsState()&#10;    val isLoading by locationViewModel.isLoading.collectAsState()&#10;    var selectedVisibilityFilter by remember { mutableStateOf(VisibilityFilter.ALL) }&#10;    var fromDate by remember { mutableStateOf&lt;Long?&gt;(null) }&#10;    var toDate by remember { mutableStateOf&lt;Long?&gt;(null) }&#10;&#10;    LaunchedEffect(currentUser?.id, selectedVisibilityFilter, fromDate, toDate) {&#10;        currentUser?.id?.let { userId -&gt;&#10;            if (userId.isNotBlank()) {&#10;                val visibility = when (selectedVisibilityFilter) {&#10;                    VisibilityFilter.PUBLIC -&gt; &quot;public&quot;&#10;                    VisibilityFilter.PRIVATE -&gt; &quot;private&quot;&#10;                    VisibilityFilter.ALL -&gt; null&#10;                }&#10;                locationViewModel.loadFilteredUserLocations(userId, fromDate, toDate, visibility)&#10;            }&#10;        }&#10;    }&#10;&#10;    LogbookContent(&#10;        navController = navController,&#10;        locations = locations,&#10;        isLoading = isLoading,&#10;        onAddClick = { navController.navigate(&quot;add&quot;) },&#10;        selectedVisibilityFilter = selectedVisibilityFilter,&#10;        onVisibilityFilterSelected = { selectedVisibilityFilter = it },&#10;        fromDate = fromDate,&#10;        toDate = toDate,&#10;        onDateRangeSelected = { start, end -&gt;&#10;            fromDate = start&#10;            toDate = end&#10;        },&#10;        locationViewModel = locationViewModel&#10;    )&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun LogbookContent(&#10;    navController: NavController,&#10;    locations: List&lt;LocationData&gt;,&#10;    isLoading: Boolean,&#10;    onAddClick: () -&gt; Unit,&#10;    selectedVisibilityFilter: VisibilityFilter,&#10;    onVisibilityFilterSelected: (VisibilityFilter) -&gt; Unit,&#10;    fromDate: Long?,&#10;    toDate: Long?,&#10;    onDateRangeSelected: (Long?, Long?) -&gt; Unit,&#10;    locationViewModel: LocationViewModel? = null&#10;) {&#10;    var showDatePicker by remember { mutableStateOf(false) }&#10;    val dateRangePickerState = rememberDateRangePickerState()&#10;    var deletedLocationIds by remember { mutableStateOf(setOf&lt;String&gt;()) }&#10;&#10;    if (showDatePicker) {&#10;        DatePickerDialog(&#10;            onDismissRequest = { showDatePicker = false },&#10;            confirmButton = {&#10;                TextButton(onClick = {&#10;                    onDateRangeSelected(&#10;                        dateRangePickerState.selectedStartDateMillis,&#10;                        dateRangePickerState.selectedEndDateMillis&#10;                    )&#10;                    showDatePicker = false&#10;                }) {&#10;                    Text(&quot;OK&quot;)&#10;                }&#10;            },&#10;            dismissButton = {&#10;                TextButton(onClick = { showDatePicker = false }) {&#10;                    Text(&quot;Cancel&quot;)&#10;                }&#10;            }&#10;        ) {&#10;            DateRangePicker(state = dateRangePickerState)&#10;        }&#10;    }&#10;&#10;    Scaffold(&#10;        floatingActionButton = {&#10;            FloatingActionButton(&#10;                onClick = onAddClick,&#10;                containerColor = MaterialTheme.colorScheme.primary,&#10;                contentColor = Color.White,&#10;                modifier = Modifier.padding(16.dp)&#10;            ) {&#10;                Icon(&#10;                    imageVector = Icons.Default.Add,&#10;                    contentDescription = &quot;Add Location&quot;&#10;                )&#10;            }&#10;        }&#10;    ) { paddingValues -&gt;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .background(Color(0xFFE8F4F8))&#10;                .padding(paddingValues)&#10;        ) {&#10;            Text(&#10;                text = &quot;My Logbook&quot;,&#10;                fontSize = 28.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                modifier = Modifier.padding(start = 16.dp, top = 16.dp, end = 16.dp)&#10;            )&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            // Visibility Filters&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(horizontal = 16.dp),&#10;                horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;            ) {&#10;                VisibilityFilter.entries.forEach { filter -&gt;&#10;                    StyledFilterChip(&#10;                        label = filter.name.lowercase().replaceFirstChar { it.uppercase() },&#10;                        selected = selectedVisibilityFilter == filter,&#10;                        onClick = { onVisibilityFilterSelected(filter) }&#10;                    )&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;&#10;            // Date Filter Buttons&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(horizontal = 16.dp),&#10;                horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;            ) {&#10;                StyledFilterChip(&#10;                    label = &quot;Custom Date&quot;,&#10;                    selected = fromDate != null || toDate != null,&#10;                    onClick = { showDatePicker = true }&#10;                )&#10;                StyledFilterChip(&#10;                    label = &quot;Clear Dates&quot;,&#10;                    selected = false,&#10;                    onClick = { onDateRangeSelected(null, null) }&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            if (isLoading) {&#10;                CenteredLoadingIndicator(message = &quot;Loading locations...&quot;)&#10;            } else if (locations.isEmpty()) {&#10;                Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;                    Text(&#10;                        text = &quot;No locations found for this filter.\nTap the '+' button to add one!&quot;,&#10;                        textAlign = TextAlign.Center,&#10;                        fontSize = 18.sp,&#10;                        color = Color.Gray,&#10;                        modifier = Modifier.padding(horizontal = 16.dp)&#10;                    )&#10;                }&#10;            } else {&#10;                LazyColumn(&#10;                    modifier = Modifier&#10;                        .fillMaxSize()&#10;                        .padding(horizontal = 16.dp),&#10;                    verticalArrangement = Arrangement.spacedBy(12.dp)&#10;                ) {&#10;                    items(&#10;                        items = locations.filter { it.id !in deletedLocationIds },&#10;                        key = { it.id }&#10;                    ) { location -&gt;&#10;                        AnimatedVisibility(&#10;                            visible = location.id !in deletedLocationIds,&#10;                            exit = shrinkVertically(&#10;                                animationSpec = tween(durationMillis = 300)&#10;                            ) + fadeOut()&#10;                        ) {&#10;                            SwipeToDeleteLocationItem(&#10;                                location = location,&#10;                                onClick = {&#10;                                    val encodedName = URLEncoder.encode(location.name, StandardCharsets.UTF_8.toString())&#10;                                    val encodedDesc = URLEncoder.encode(location.description, StandardCharsets.UTF_8.toString())&#10;                                    navController.navigate(&quot;home?lat=${location.latitude}&amp;lng=${location.longitude}&amp;name=$encodedName&amp;desc=$encodedDesc&quot;)&#10;                                },&#10;                                onDelete = {&#10;                                    deletedLocationIds = deletedLocationIds + location.id&#10;                                    locationViewModel?.deleteLocation(location.id)&#10;                                }&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun SwipeToDeleteLocationItem(&#10;    location: LocationData,&#10;    onClick: () -&gt; Unit,&#10;    onDelete: () -&gt; Unit&#10;) {&#10;    val dismissState = rememberSwipeToDismissBoxState(&#10;        confirmValueChange = { dismissValue -&gt;&#10;            if (dismissValue == SwipeToDismissBoxValue.EndToStart) {&#10;                onDelete()&#10;                true&#10;            } else {&#10;                false&#10;            }&#10;        }&#10;    )&#10;&#10;    SwipeToDismissBox(&#10;        state = dismissState,&#10;        backgroundContent = {&#10;            val color = when (dismissState.dismissDirection) {&#10;                SwipeToDismissBoxValue.EndToStart -&gt; Color(0xFFE53935)&#10;                else -&gt; Color.Transparent&#10;            }&#10;            &#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .background(color, shape = androidx.compose.foundation.shape.RoundedCornerShape(12.dp))&#10;                    .padding(horizontal = 20.dp),&#10;                contentAlignment = Alignment.CenterEnd&#10;            ) {&#10;                if (dismissState.dismissDirection == SwipeToDismissBoxValue.EndToStart) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Delete,&#10;                        contentDescription = &quot;Delete&quot;,&#10;                        tint = Color.White,&#10;                        modifier = Modifier.size(32.dp)&#10;                    )&#10;                }&#10;            }&#10;        },&#10;        enableDismissFromStartToEnd = false&#10;    ) {&#10;        LocationCard(&#10;            location = location,&#10;            onClick = onClick&#10;        )&#10;    }&#10;}&#10;&#10;&#10;// Helper function to get the start of the day for a given timestamp&#10;@Suppress(&quot;unused&quot;)&#10;private fun getStartOfDay(timestamp: Long): Long {&#10;    val calendar = Calendar.getInstance()&#10;    calendar.timeInMillis = timestamp&#10;    calendar.set(Calendar.HOUR_OF_DAY, 0)&#10;    calendar.set(Calendar.MINUTE, 0)&#10;    calendar.set(Calendar.SECOND, 0)&#10;    calendar.set(Calendar.MILLISECOND, 0)&#10;    return calendar.timeInMillis&#10;}&#10;&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun LogbookScreenPreview() {&#10;    val mockNavController = rememberNavController()&#10;    val mockLocations = listOf(&#10;        LocationData(id = &quot;1&quot;, name = &quot;Eiffel Tower&quot;, description = &quot;A visit to the famous landmark in Paris.&quot;, dateAdded = System.currentTimeMillis()),&#10;        LocationData(id = &quot;2&quot;, name = &quot;Colosseum&quot;, description = &quot;Exploring the ancient ruins in Rome.&quot;, dateAdded = System.currentTimeMillis() - 86400000)&#10;    )&#10;&#10;    PROG7314Theme {&#10;        LogbookContent(&#10;            navController = mockNavController,&#10;            locations = mockLocations,&#10;            isLoading = false,&#10;            onAddClick = {},&#10;            selectedVisibilityFilter = VisibilityFilter.ALL,&#10;            onVisibilityFilterSelected = {},&#10;            fromDate = null,&#10;            toDate = null,&#10;            onDateRangeSelected = { _, _ -&gt; },&#10;            locationViewModel = null&#10;        )&#10;    }&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun LogbookScreenEmptyPreview() {&#10;    val mockNavController = rememberNavController()&#10;    PROG7314Theme {&#10;        LogbookContent(&#10;            navController = mockNavController,&#10;            locations = emptyList(),&#10;            isLoading = false,&#10;            onAddClick = {},&#10;            selectedVisibilityFilter = VisibilityFilter.ALL,&#10;            onVisibilityFilterSelected = {},&#10;            fromDate = null,&#10;            toDate = null,&#10;            onDateRangeSelected = { _, _ -&gt; },&#10;            locationViewModel = null&#10;        )&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>